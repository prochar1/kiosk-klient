# Kiosk Klient

Desktopov√° aplikace pro kiosk syst√©m postaven√° na Python backendu s webview rozhran√≠m a p≈ô√≠m√Ωm JavaScript API.

## üìã Popis

Kiosk Klient je fullscreen aplikace urƒçen√° pro kiosk syst√©my, kter√° kombinuje:

- **Python backend** s modul√°rn√≠ architekturou
- **HTML/CSS/JS frontend** pro u≈æivatelsk√© rozhran√≠
- **PyWebView** pro vytvo≈ôen√≠ nativn√≠ho okna aplikace
- **P≈ô√≠m√© JavaScript API** pro vol√°n√≠ Python funkc√≠
- **UDP komunikaci** pro odes√≠l√°n√≠ a p≈ô√≠jem zpr√°v
- **Wget integrace** pro automatick√© aktualizace obsahu

## üöÄ Funkce

- **Fullscreen kiosk rozhran√≠** bez r√°meƒçk≈Ø a ovl√°dac√≠ch prvk≈Ø
- **P≈ô√≠m√© JavaScript API** - vol√°n√≠ Python funkc√≠ bez HTTP
- **UDP komunikace** - odes√≠l√°n√≠ a p≈ô√≠jem zpr√°v
- **Konfigurovateln√© argumenty** - porty, ƒçasy, debug re≈æim
- **Automatick√© aktualizace HTML** pomoc√≠ wget
- **F5/Ctrl+F5 refresh** pro obnoven√≠ obsahu
- **Modul√°rn√≠ architektura** - rozdƒõleno do v√≠ce soubor≈Ø
- **Cross-platform podpora** d√≠ky PyWebView

## üõ†Ô∏è Technologie

- **Python 3.x**
- **Flask** - Serv√≠rov√°n√≠ HTML soubor≈Ø
- **PyWebView** - Desktop GUI wrapper s JavaScript API
- **Socket** - UDP komunikace
- **Threading** - Asynchronn√≠ bƒõh serveru a UDP receiveru
- **Subprocess** - Wget integrace
- **PyInstaller** - Bal√≠ƒçkov√°n√≠ do exe (kiosk.spec)

## üì¶ Instalace

### Po≈æadavky

```bash
pip install flask pywebview
```

### Struktura projektu

```
kiosk-klient/
‚îú‚îÄ‚îÄ kiosk.py              # Hlavn√≠ spou≈°tƒõc√≠ skript
‚îú‚îÄ‚îÄ config.py             # Konfigurace a zpracov√°n√≠ argument≈Ø
‚îú‚îÄ‚îÄ flask_server.py       # Flask server pro HTML soubory
‚îú‚îÄ‚îÄ python_api.py         # JavaScript API + rotuj√≠c√≠ logov√°n√≠
‚îú‚îÄ‚îÄ udp_receiver.py       # UDP receiver pro p≈ô√≠jem zpr√°v
‚îú‚îÄ‚îÄ webview_app.py        # Vytvo≈ôen√≠ a spr√°va webview okna
‚îú‚îÄ‚îÄ kiosk.spec            # PyInstaller konfigurace (embedded wget)
‚îú‚îÄ‚îÄ wget.exe              # Wget pro Windows (zabal√≠ se do exe)
‚îú‚îÄ‚îÄ html/                 # HTML build soubory
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ log/                  # Rotuj√≠c√≠ logy (vytvo≈ô√≠ se automaticky)
‚îÇ   ‚îú‚îÄ‚îÄ kiosk.log
‚îÇ   ‚îú‚îÄ‚îÄ kiosk.log.1
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ API_DOCUMENTATION.md  # Dokumentace JavaScript API
‚îî‚îÄ‚îÄ README.md
```

## üéÆ Pou≈æit√≠

### Spu≈°tƒõn√≠ aplikace

1. Um√≠stƒõte HTML obsah do slo≈æky `html/`
2. Spus≈•te aplikaci:

**V√Ωvojov√Ω re≈æim (s debug panel, okno s r√°meƒçkem):**

```bash
python kiosk.py -debug
```

**Produkƒçn√≠ re≈æim (fullscreen, bez r√°meƒçku, v≈ædy navrchu):**

```bash
python kiosk.py
```

**S vlastn√≠mi argumenty:**

```bash
python kiosk.py -inport 51000 -outport 51001 -totaltime 3600 -remainingtime 1800 -groupmode true
```

### Dostupn√© argumenty

| Argument                  | Popis                                                | Default    |
| ------------------------- | ---------------------------------------------------- | ---------- |
| `-debug`                  | Zapne debug re≈æim (okno s r√°meƒçkem, developer tools) | False      |
| `-inport <port>`          | Port pro p≈ô√≠jem UDP zpr√°v                            | 9001       |
| `-outport <port>`         | Port pro odes√≠l√°n√≠ UDP zpr√°v                         | 9002       |
| `-totaltime <sec>`        | Celkov√Ω ƒças v sekund√°ch                              | 3600       |
| `-remainingtime <sec>`    | Zb√Ωvaj√≠c√≠ ƒças v sekund√°ch                            | 3600       |
| `-groupmode <true/false>` | Hern√≠ m√≥d (Individual/Group)                         | Individual |

### Vytvo≈ôen√≠ exe souboru

```bash
pyinstaller kiosk.spec
```

## üîå JavaScript API

Aplikace poskytuje p≈ô√≠m√© JavaScript API pro vol√°n√≠ Python funkc√≠ bez pot≈ôeby HTTP po≈æadavk≈Ø.

### Dostupn√© funkce

V≈°echny funkce jsou dostupn√© p≈ôes `window.pywebview.api` objekt a vrac√≠ Promise.

#### `send_udp_message(message, server?, port?)`

Odes√≠l√° UDP zpr√°vu s libovoln√Ωmi daty.

**Parametry:**

- `message` (object) - Data zpr√°vy jako JavaScript objekt
- `server` (string, voliteln√Ω) - IP adresa serveru (default: '127.0.0.1')
- `port` (number, voliteln√Ω) - Port serveru (default: hodnota z -outport argumentu)

**JavaScript p≈ô√≠klady:**

```javascript
// Z√°kladn√≠ pou≈æit√≠ s defaulty
await window.pywebview.api.send_udp_message({
  type: "game_start",
  player: "John",
  score: 100,
});

// S vlastn√≠m serverem a portem
await window.pywebview.api.send_udp_message(
  { type: "test", data: "hello" },
  "192.168.1.100",
  9000
);

// Pouze vlastn√≠ port
await window.pywebview.api.send_udp_message({ action: "ping" }, null, 8080);
```

#### `get_config()`

Vrac√≠ aktu√°ln√≠ konfiguraci aplikace.

```javascript
const config = await window.pywebview.api.get_config();
console.log(config);
// {
//   ServerReceivePort: 51000,
//   ServerSendPort: 51001,
//   TotalTime: 3600,
//   RemainingTime: 3600,
//   GameMode: 'Individual'
// }
```

#### `test_connection()`

Testovac√≠ funkce pro ovƒõ≈ôen√≠ dostupnosti API.

```javascript
const result = await window.pywebview.api.test_connection();
console.log(result.status); // 'success'
```

#### `update_html(url)`

Aktualizuje HTML obsah aplikace sta≈æen√≠m z URL pomoc√≠ wget.

```javascript
await window.pywebview.api.update_html("https://example.com/new-version");
// Aplikace se automaticky restartuje po dokonƒçen√≠
```

### UDP Receiver

Aplikace automaticky naslouch√° UDP zpr√°v√°m na portu z `-inport` argumentu a p≈ôed√°v√° je do JavaScriptu.

**Nastaven√≠ handleru:**

```javascript
window.onUdpMessage = function (message) {
  console.log("P≈ôijata UDP zpr√°va:", message);

  // Parsov√°n√≠ JSON zpr√°vy
  try {
    const data = JSON.parse(message);
    handleGameMessage(data);
  } catch (e) {
    console.log("Raw message:", message);
  }
};
```

### Kompletn√≠ p≈ô√≠klad

```javascript
document.addEventListener("DOMContentLoaded", async function () {
  // Test API
  await window.pywebview.api.test_connection();

  // Naƒçten√≠ konfigurace
  const config = await window.pywebview.api.get_config();

  // Nastaven√≠ UDP handleru
  window.onUdpMessage = function (msg) {
    console.log("UDP:", msg);
  };

  // Odesl√°n√≠ zpr√°vy
  await window.pywebview.api.send_udp_message({
    type: "app_ready",
    config: config,
  });
});
```

## ‚öôÔ∏è Konfigurace

### Porty

- **Flask server**: 5001 (pouze pro HTML soubory)
- **UDP p≈ô√≠jem**: 9001 (nebo hodnota z `-inport`)
- **UDP odes√≠l√°n√≠**: 9002 (nebo hodnota z `-outport`)

### Okno aplikace

- **Rozli≈°en√≠**: 1920x1080
- **V√Ωvojov√Ω re≈æim** (`-debug`): Okno s r√°meƒçkem, developer tools
- **Produkƒçn√≠ re≈æim**: Fullscreen, bez r√°meƒçk≈Ø, v≈ædy navrchu
- **Velikost**: Pevn√° (nemƒõniteln√°)

### Kl√°vesov√© zkratky

- **F5**: Norm√°ln√≠ refresh str√°nky
- **Ctrl+F5**: Tvrd√Ω refresh s vyƒçi≈°tƒõn√≠m cache

### Moduly

| Modul             | √öƒçel                                 |
| ----------------- | ------------------------------------ |
| `kiosk.py`        | Hlavn√≠ spou≈°tƒõc√≠ skript, orchestrace |
| `config.py`       | Zpracov√°n√≠ argument≈Ø, konfigurace    |
| `flask_server.py` | Serv√≠rov√°n√≠ HTML soubor≈Ø             |
| `python_api.py`   | JavaScript API pro p≈ô√≠m√© vol√°n√≠      |
| `udp_receiver.py` | P≈ô√≠jem UDP zpr√°v                     |
| `webview_app.py`  | Vytvo≈ôen√≠ webview okna               |

## üîß V√Ωvoj a testov√°n√≠

### Detekce prost≈ôed√≠

Aplikace automaticky detekuje prost≈ôed√≠:

- **Development**: Spu≈°tƒõno jako `.py` skript - obsah ze slo≈æky `html/`
- **Production**: Spu≈°tƒõno jako PyInstaller exe - obsah ze slo≈æky `html/`

### Testov√°n√≠ API

1. **Spus≈• aplikaci v debug re≈æimu:**

```bash
python kiosk.py -debug -inport 51000 -outport 51001
```

2. **Otev≈ôi Developer Console (F12) a testuj:**

```javascript
// Test API p≈ôipojen√≠
await window.pywebview.api.test_connection();

// Test konfigurace
await window.pywebview.api.get_config();

// Test UDP zpr√°vy
await window.pywebview.api.send_udp_message({
  type: "test",
  message: "Hello from JavaScript!",
});
```

3. **Sleduj UDP zpr√°vy v termin√°lu:**

```bash
python -c "
import socket, json
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.bind(('127.0.0.1', 51001))
print('Listening on port 51001...')
while True:
    data, addr = sock.recvfrom(1024)
    print(f'Received: {data.decode()}')
"
```

### Logov√°n√≠

Aplikace m√° integrovan√© rotuj√≠c√≠ logov√°n√≠ do slo≈æky `log/`:

**Um√≠stƒõn√≠ log≈Ø:**

- **Development**: `./log/kiosk.log`
- **Production**: `./log/kiosk.log` (vedle exe souboru)

**√örovnƒõ logov√°n√≠:**

- **Debug re≈æim** (`-debug`): V≈°echny zpr√°vy (DEBUG a v√Ω≈°e)
- **Development**: INFO a v√Ω≈°e
- **Production**: Pouze WARNING a ERROR

**Rotace log≈Ø:**

- **Maxim√°ln√≠ velikost**: 1MB per soubor
- **Poƒçet soubor≈Ø**: 4 soubory (kiosk.log + kiosk.log.1-3)
- **Celkov√° velikost**: Max 4MB
- **Automatick√© ƒçi≈°tƒõn√≠**: Star≈°√≠ logy se automaticky ma≈æou

**Sledovan√© ud√°losti:**

- Spu≈°tƒõn√≠ aplikace a argumenty
- Flask server a UDP receiver inicializace
- Odes√≠l√°n√≠ a p≈ô√≠jem UDP zpr√°v
- Wget operace a aktualizace HTML
- Chyby a v√Ωjimky
- PyInstaller temp slo≈æky (v debug re≈æimu)

## üìù Pozn√°mky

### Architektura

- **Modul√°rn√≠ struktura** - k√≥d rozdƒõlen do logick√Ωch celk≈Ø
- **JavaScript API** - p≈ô√≠m√© vol√°n√≠ Python funkc√≠ bez HTTP
- **Flask server** - pouze pro serv√≠rov√°n√≠ HTML soubor≈Ø
- **UDP komunikace** - obousmƒõrn√° (p≈ô√≠jem i odes√≠l√°n√≠)
- **Threading** - asynchronn√≠ bƒõh v≈°ech komponent

### Technick√© detaily

- Flask server bƒõ≈æ√≠ v daemon vl√°knƒõ na portu 5001
- UDP receiver bƒõ≈æ√≠ v daemon vl√°knƒõ na portu z `-inport`
- UDP socket se automaticky uzav√≠r√° po odesl√°n√≠ zpr√°vy
- Chyby jsou zachyceny a vr√°ceny jako objekty s `status` a `message`
- Podporuje HTML Single Page Application routing
- F5/Ctrl+F5 kl√°vesy funguj√≠ pro refresh bez z√°vislosti na HTML obsahu

### HTML aktualizace

- Bƒõ≈æ√≠ v samostatn√©m vl√°knƒõ pro neblokov√°n√≠ UI
- **Embedded wget**: `wget.exe` je zabalen√Ω p≈ô√≠mo v exe souboru
- **Fallback**: Lok√°ln√≠ `wget.exe` vedle aplikace nebo syst√©mov√Ω `wget`
- **PyInstaller**: Wget se automaticky extrahuje do temp slo≈æky
- Star√° HTML data jsou automaticky z√°lohov√°na s ƒçasov√Ωm raz√≠tkem
- Aplikace se automaticky restartuje po √∫spƒõ≈°n√© aktualizaci
- Blokuje souƒçasn√© spu≈°tƒõn√≠ v√≠ce aktualizac√≠

### Nasazen√≠

**Single-file executable:**

- `kiosk.exe` obsahuje v≈°e pot≈ôebn√© vƒçetnƒõ `wget.exe`
- ≈Ω√°dn√© extern√≠ z√°vislosti
- Portable - lze spou≈°tƒõt kdekoli
- Automatick√© vytvo≈ôen√≠ `log/` a `html/` slo≈æek

### V√Ωhody nov√©ho API

- ‚úÖ **Rychlej≈°√≠** - bez HTTP overhead
- ‚úÖ **Jednodu≈°≈°√≠** - p≈ô√≠m√© vol√°n√≠ Python funkc√≠
- ‚úÖ **Bezpeƒçnƒõj≈°√≠** - bez otev≈ôen√Ωch HTTP API port≈Ø
- ‚úÖ **Nativn√≠** - integr√°no do pywebview
- ‚úÖ **Asynchronn√≠** - v≈°echna vol√°n√≠ vrac√≠ Promise

## ü§ù P≈ôisp√≠v√°n√≠

1. Fork projektu
2. Vytvo≈ôte feature branch (`git checkout -b feature/nova-funkce`)
3. Commit zmƒõny (`git commit -am 'P≈ôid√°na nov√° funkce'`)
4. Push do branch (`git push origin feature/nova-funkce`)
5. Vytvo≈ôte Pull Request

## üìÑ Licence

Tento projekt je licencov√°n pod [MIT licenc√≠](LICENSE).
